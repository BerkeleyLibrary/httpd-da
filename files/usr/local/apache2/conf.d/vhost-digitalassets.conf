<VirtualHost _default_:80>
  ServerName digitalassets.lib.berkeley.edu
  ServerAdmin webman@library.berkeley.edu

  DocumentRoot /srv/da_symlinks
  #ErrorDocument 404 http://www.lib.berkeley.edu/notfound.html
  ErrorDocument 404 "The requested asset could not be found."

  # NOTE(dcschmidt): Implements custom styles. This depends on settings in
  # autoindex.conf that alias and allow the .html/ directory.
  #
  # @see http://digitalassets.lib.berkeley.edu/UCBonly/ldc/2004T04/ Test Case
  # @see https://git.lib.berkeley.edu/lap/digital-preservation-assets/issues/1
  IndexHeadInsert "<meta name=\"viewport\" content=\"width=device-width\">"
  IndexHeadInsert "<link rel=\"stylesheet\" href=\"https://use.typekit.net/rxa5jay.css\">"
  IndexStyleSheet /.html/css/style.css
  ReadmeName /.html/partials/footer.html
  HeaderName /.html/partials/header.html

  # NOTE(dcschmidt): Adds Google Analytics tracking code. The tracker ID
  # differs between PA/DA.
  # @see https://ucblib.atlassian.net/browse/DEV-199
  IndexHeadInsert "<!-- Google tag (gtag.js) --> \
  <script async src='https://www.googletagmanager.com/gtag/js?id=G-02XKC8Q8JN'></script> \
  <script> \
    window.dataLayer = window.dataLayer || []; \
    function gtag(){dataLayer.push(arguments);} \
    gtag('js', new Date()); \
    gtag('config', 'G-02XKC8Q8JN'); \
  </script>"

  <Directory /srv/da_symlinks>
    Options All
    AllowOverride All
    <RequireAll>
      Require all granted
      Require not ip 218.19.109.80
    </RequireAll>
  </Directory>

  <Directory /srv/da_symlinks/cas>
    AuthType CAS
    Require valid-user
  </Directory>

  # Mark Twain Project
  <Directory /srv/da_symlinks/mtnotebooks>
    <RequireAll>
      Require env MarkTwainUsers
    </RequireAll>
  </Directory>

  # City Art
  <Directory /srv/da_symlinks/cityarts>
    <RequireAll>
      Require not env UCBonlyDenyFrom

      <RequireAny>
        Require env UCBonlyAllowFrom

        Require ip \
          128.3.2 \
          128.48.120.136 \
          128.48.120.139 \
          131.243 \
          192.35.209.158 \
          192.35.209.170

        Require host \
          dp08.cdlib.org \
          ferret.cdlib.org \
          ingest01.cdlib.org \
          ingest02.cdlib.org \
          ingest03.cdlib.org \
          lbl.gov \
          loon.ucop.edu \
          preserve-stage.cdlib.org
      </RequireAny>
    </RequireAll>
  </Directory>

  # UCB Only for TechAmerica
  <Directory /srv/da_symlinks/busi>
    <Files TechAmerica-Foundation-Cyberstates-2013.pdf >
      <RequireAll>
        Require not env UCBonlyDenyFrom
        Require env UCBonlyAllowFrom
      </RequireAll>
    </Files>
  </Directory>

  #-----------------------------------------------------
  # UCB Only for digital assets
  <Directory /srv/da_symlinks/UCBonly>
    <RequireAll>
      Require not env UCBonlyDenyFrom
      Require env UCBonlyAllowFrom
    </RequireAll>
  </Directory>

  # UCB Only for NCL
  <Directory /srv/da_symlinks/ncl>
    <RequireAll>
      Require not env UCBonlyDenyFrom
      Require env UCBonlyAllowFrom
    </RequireAll>
  </Directory>

  # UCB Only for Jarda
  <Directory /srv/da_symlinks/jarda/ucb/UCBOnly>
    <RequireAll>
      Require not env UCBonlyDenyFrom
      Require env UCBonlyAllowFrom
    </RequireAll>
  </Directory>

  # UCB Only for JJOYCE
  <Directory /srv/da_symlinks/jjoyce>
    <RequireAll>
      Require not env UCBonlyDenyFrom
      Require env UCBonlyAllowFrom
    </RequireAll>
  </Directory>

  # UCB Only for Bios
  <Directory /srv/da_symlinks/bios/UCBonly>
    <RequireAll>
      Require not env UCBonlyDenyFrom
      Require env UCBonlyAllowFrom
    </RequireAll>
  </Directory>

  #-----------------------------------------------------
  # Basic auth w/named user for hathitrust_submission

  <Directory /srv/da_symlinks/hathitrust_submission>
    <RequireAll>
      AuthType Basic
      AuthName hathitrust_submission
      AuthBasicProvider file
      AuthUserFile "/etc/httpd/authusers"
      Require user HathiAuth
    </RequireAll>
  </Directory>
</VirtualHost>
